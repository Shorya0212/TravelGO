<% layout("/layouts/boilerplate.ejs") %>

<body>
  <div class="container my-5">
    <div class="card shadow-lg mx-auto" style="max-width: 700px;">
      <!-- Image -->
      <img
        src="<%= listing.image && listing.image.url ? listing.image.url : '/path/to/default-image.jpg' %>"
        class="card-img-top"
        alt="<%= listing.title %>"
        style="height: 400px; object-fit: cover;">

      <div class="card-body">
        <!-- Title -->
        <h2 class="card-title text-center mb-3"><%= listing.title %></h2>

        <!-- Description -->
        <p class="card-text mb-3"><%= listing.description %></p>

        <!-- Price -->
        <h4 class="text-danger mb-3">
          ₹<%= listing.price ? listing.price.toLocaleString("en-IN") : "N/A" %>/Night
        </h4>

        <!-- Location & Country -->
        <p class="text-muted mb-4">
          <strong>Location:</strong> <%= listing.location %> <br>
          <strong>Country:</strong> <%= listing.country %>
        </p>

        <!-- Action Buttons -->
        <div class="d-flex justify-content-between">
          <a href="/listings/<%= listing._id %>/edit" class="btn btn-primary">Edit Listing</a>
          <form method="post" action="/listings/<%= listing._id %>?_method=DELETE">
            <button type="submit" class="btn btn-danger">Delete Listing</button>
          </form>
        </div>

        <!-- Reviews Section -->
        <div class="mt-5">
          <h4>Reviews</h4>
          <% if (listing.reviews && listing.reviews.length > 0) { %>
            <ul class="list-group mb-4">
              <% listing.reviews.forEach(function(review) { %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <strong>Rating:</strong> <%= review.rating %> ⭐<br>
                    <%= review.comment %>
                  </div>
                  <form method="POST" action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" style="margin:0;">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                  </form>
                </li>
              <% }) %>
            </ul>
          <% } else { %>
            <p class="text-muted">No reviews yet.</p>
          <% } %>
        </div>

        <!-- Review Form -->
        <form action="/listings/<%= listing._id %>/reviews" method="POST" novalidate class="mb-4 needs-validation">
          <h4>Leave a Review</h4>
          <div class="form-group">
            <label for="review-comment">Review:</label>
            <textarea class="form-control" id="review-comment" name="review[comment]" rows="3" required></textarea>
          </div>
          <div class="form-group">
            <label for="review-rating">Rating:</label>
            <select class="form-control" id="review-rating" name="review[rating]" required>
              <option value="1">⭐</option>
              <option value="2">⭐⭐</option>
              <option value="3">⭐⭐⭐</option>
              <option value="4">⭐⭐⭐⭐</option>
              <option value="5">⭐⭐⭐⭐⭐</option>
            </select>
          </div>
          <br>
          <button type="submit" class="btn btn-primary">Submit Review</button>
        </form>
      </div>  
    </div>
  </div>

  <style>
    body {
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
    }

    .card {
      border-radius: 15px;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .card-title {
      font-weight: 700;
      color: #333;
    }

    .card-text {
      font-size: 1rem;
      color: #555;
    }

    .btn {
      min-width: 120px;
    }
  </style>
</body>
